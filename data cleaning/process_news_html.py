# stock_news_analyzer_v2.py
# 個股新聞分析系統 - 針對個別公司的新聞篩選與分析

import re
import json
import time
from pathlib import Path
from collections import Counter, defaultdict
from multiprocessing import Pool, cpu_count

import pandas as pd
from bs4 import BeautifulSoup
from tqdm import tqdm

# ==================== CONFIG ====================
NEWS_ROOT_FOLDER = r"C:\Users\a7385\OneDrive\Desktop\程式接案\news"
OUT_CSV = "individual_stock_news.csv"  # 單一輸出檔案
OUT_COMPANY_STATS = "company_statistics.json"  # 公司統計報告
OUT_QC_REPORT = "news_qc_report_v2.json"

TEST_LIMIT = None  # 設為None表示處理全部檔案
NUM_WORKERS = max(1, cpu_count() - 1)
MIN_CONTENT_LENGTH = 50

# ==================== 排除大盤相關關鍵字 ====================
EXCLUDE_KEYWORDS = [
    '加權指數', '大盤', '台股指數', '盤勢', '大盤走勢',
    '整體市場', '市場氛圍', '總體經濟', '經濟成長', 'GDP',
    '央行', '聯準會', '升息', '降息', '貨幣政策',
    '外資動向', '三大法人', '台股封關', '台股開盤'
]

EXCLUDE_PATTERN = re.compile('|'.join(map(re.escape, EXCLUDE_KEYWORDS)), re.IGNORECASE)

# ==================== 公司名稱與代號資料庫 ====================
# 這裡可以擴充更多公司，格式: {'公司名稱': '股票代號'}
COMPANY_DATABASE = {
    # 原始資料 - 科技業
    '台積電': '2330', 'TSMC': '2330', '聯發科': '2454', '聯發科技': '2454', '鴻海': '2317',
    '富士康': '2317', '大立光': '3008', '廣達': '2382', '華亞科': '3474', '矽品': '2325',
    '日月光': '2311', '群創': '3481', '友達': '2409', '台達電': '2308', '瑞昱': '2379',
    '聯電': '2303', '南亞科': '2408', '晶電': '2448', '漢微科': '3658',

    # 原始資料 - 金融業
    '中信金': '2891', '國泰金': '2882', '富邦金': '2881', '玉山金': '2884',
    '第一金': '2892', '兆豐金': '2886',

    # 原始資料 - 傳產
    '台塑': '1301', '南亞': '1303', '台化': '1326',

    # 原始資料 - 生技
    '浩鼎': '4174', '中裕': '4147', '旭富': '4119', '佰研': '3205',
    '優盛': '4121', '台微體': '4152',

    # 新增資料 - 個股部分 (已排除 ETF/債券/特別股/DR/ETN/REITs/槓桿反向型產品)
    '台泥': '1101', '亞泥': '1102', '嘉泥': '1103', '環泥': '1104', '幸福': '1108',
    '信大': '1109', '東泥': '1110', '味全': '1201', '味王': '1203', '大成': '1210',
    '大飲': '1213', '卜蜂': '1215', '統一': '1216', '愛之味': '1217', '泰山': '1218',
    '福壽': '1219', '台榮': '1220', '福懋油': '1225', '佳格': '1227', '聯華': '1229',
    '聯華食': '1231', '大統益': '1232', '天仁': '1233', '黑松': '1234', '興泰': '1235',
    '宏亞': '1236', '茂生農經': '1240', '鮮活果汁-KY': '1256', '其祥-KY': '1258', '安心': '1259',
    '富味鄉': '1260', '德麥': '1264', '漢來美食': '1268', '乾杯': '1269', '台聚': '1304',
    '華夏': '1305', '三芳': '1307', '亞聚': '1308', '台達化': '1309', '台苯': '1310',
    '國喬': '1312', '聯成': '1313', '中石化': '1314', '達新': '1315', '上曜': '1316',
    '東陽': '1319', '大洋': '1321', '永裕': '1323', '地球': '1324', '恆大': '1325',
    '台翰': '1336', '再生-KY': '1337', '廣華-KY': '1338', '昭輝': '1339', '勝悅-KY': '1340',
    '富林-KY': '1341', '八貫': '1342', '遠東新': '1402', '新纖': '1409', '南染': '1410',
    '宏洲': '1413', '東和': '1414', '廣豐': '1416', '嘉裕': '1417', '東華': '1418',
    '新紡': '1419', '利華': '1423', '大魯閣': '1432', '福懋': '1434', '中福': '1435',
    '華友聯': '1436', '勤益控': '1437', '裕豐': '1438', '中和': '1439', '南紡': '1440',
    '大東': '1441', '名軒': '1442', '立益': '1443', '力麗': '1444', '大宇': '1445',
    '宏和': '1446', '力鵬': '1447', '佳和': '1449', '年興': '1451', '宏益': '1452',
    '大將': '1453', '台富': '1454', '集盛': '1455', '怡華': '1456', '宜進': '1457',
    '聯發': '1459', '宏遠': '1460', '強盛': '1463', '得力': '1464', '偉全': '1465',
    '聚隆': '1466', '南緯': '1467', '昶和': '1468', '大統新創': '1470', '首利': '1471',
    '三洋紡': '1472', '台南': '1473', '弘裕': '1474', '本盟': '1475', '儒鴻': '1476',
    '聚陽': '1477', '士電': '1503', '東元': '1504', '正道': '1506', '永大': '1507',
    '瑞利': '1512', '中興電': '1513', '亞力': '1514', '力山': '1515', '川飛': '1516',
    '利奇': '1517', '華城': '1519', '大億': '1521', '堤維西': '1522', '耿鼎': '1524',
    '江申': '1525', '日馳': '1526', '鑽全': '1527', '恩德': '1528', '樂士': '1529',
    '亞崴': '1530', '高林股': '1531', '勤美': '1532', '車王電': '1533', '中宇': '1535',
    '和大': '1536', '廣隆': '1537', '正峰新': '1538', '巨庭': '1539', '喬福': '1540',
    '錩泰': '1541', '伸興': '1558', '中砂': '1560', '巧新': '1563', '精華': '1565',
    '倉佑': '1568', '濱川': '1569', '力肯': '1570', '新麥': '1580', '信錦': '1582',
    '程泰': '1583', '精剛': '1584', '鎧鉅': '1585', '和勤': '1586', '吉茂': '1587',
    '永冠-KY': '1589', '亞德客-KY': '1590', '駿吉-KY': '1591', '英瑞-KY': '1592', '祺驊': '1593',
    '日高': '1594', '川寶': '1595', '直得': '1597', '岱宇': '1598', '宏佳騰': '1599',
    '華電': '1603', '聲寶': '1604', '華新': '1605', '華榮': '1608', '大亞': '1609',
    '中電': '1611', '宏泰': '1612', '三洋電': '1614', '大山': '1615', '億泰': '1616',
    '榮星': '1617', '合機': '1618', '艾美特-KY': '1626', '中化': '1701', '南僑': '1702',
    '葡萄王': '1707', '東鹼': '1708', '和益': '1709', '東聯': '1710', '永光': '1711',
    '興農': '1712', '國化': '1713', '和桐': '1714', '長興': '1717', '中纖': '1718',
    '生達': '1720', '三晃': '1721', '台肥': '1722', '中碳': '1723', '台硝': '1724',
    '元禎': '1725', '永記': '1726', '中華化': '1727', '花仙子': '1730', '美吾華': '1731',
    '毛寶': '1732', '五鼎': '1733', '杏輝': '1734', '日勝化': '1735', '喬山': '1736',
    '臺鹽': '1737', '台蠟': '1742', '南光': '1752', '寶齡富錦': '1760', '中化生': '1762',
    '勝一': '1773', '展宇': '1776', '生泰': '1777', '立弘': '1780', '合世': '1781',
    '和康生': '1783', '訊聯': '1784', '光洋科': '1785', '科妍': '1786', '杏昌': '1788',
    '神隆': '1789', '美時': '1795', '金穎生技': '1796', '易威': '1799', '台玻': '1802',
    '寶徠': '1805', '冠軍': '1806', '潤隆': '1808', '中釉': '1809', '和成': '1810',
    '寶利徠': '1813', '富喬': '1815', '凱撒衛': '1817', '士紙': '1903', '正隆': '1904',
    '華紙': '1905', '寶隆': '1906', '永豐餘': '1907', '榮成': '1909', '中鋼': '2002',
    '東和鋼鐵': '2006', '燁興': '2007', '高興昌': '2008', '第一銅': '2009', '春源': '2010',
    '春雨': '2012', '中鋼構': '2013', '中鴻': '2014', '豐興': '2015', '官田鋼': '2017',
    '美亞': '2020', '聚亨': '2022', '燁輝': '2023', '志聯': '2024', '千興': '2025',
    '大成鋼': '2027', '威致': '2028', '盛餘': '2029', '彰源': '2030', '新光鋼': '2031',
    '新鋼': '2032', '佳大': '2033', '允強': '2034', '唐榮': '2035', '海光': '2038',
    '上銀': '2049', '川湖': '2059', '風青': '2061', '橋椿': '2062', '世鎧': '2063',
    '晉椿': '2064', '世豐': '2065', '世德': '2066', '嘉鋼': '2067', '運錩': '2069',
    '精湛': '2070', '震南鐵': '2071', '南港': '2101', '泰豐': '2102', '台橡': '2103',
    '國際中橡': '2104', '正新': '2105', '建大': '2106', '厚生': '2107', '南帝': '2108',
    '華豐': '2109', '鑫永銓': '2114', '六暉-KY': '2115', '裕隆': '2201', '中華': '2204',
    '三陽工業': '2206', '和泰車': '2207', '台船': '2208', '長榮鋼': '2211', '大甲': '2221',
    '裕日車': '2227', '劍麟': '2228', '泰茂': '2230', '為升': '2231', '宇隆': '2233',
    '謚源': '2235', '百達-KY': '2236', '華德動能': '2237', '英利-KY': '2239', '艾姆勒': '2241',
    '宏旭-KY': '2243', '詠勝昌': '2245', '凱勝綠能': '2246', '汎德永業': '2247', '華勝-KY': '2248',
    '湧盛': '2249', '光寶科': '2301', '麗正': '2302', '全友': '2305', '金寶': '2312',
    '華通': '2313', '台揚': '2314', '楠梓電': '2316', '東訊': '2321', '中環': '2323',
    '仁寶': '2324', '國巨': '2327', '廣宇': '2328', '華泰': '2329', '精英': '2331',
    '友訊': '2332', '旺宏': '2337', '光罩': '2338', '光磊': '2340', '茂矽': '2342',
    '華邦電': '2344', '智邦': '2345', '聯強': '2347', '海悅': '2348', '錸德': '2349',
    '順德': '2351', '佳世達': '2352', '宏碁': '2353', '鴻準': '2354', '敬鵬': '2355',
    '英業達': '2356', '華碩': '2357', '廷鑫': '2358', '所羅門': '2359', '致茂': '2360',
    '藍天': '2362', '矽統': '2363', '倫飛': '2364', '昆盈': '2365', '燿華': '2367',
    '金像電': '2368', '菱生': '2369', '大同': '2371', '震旦行': '2373', '佳能': '2374',
    '凱美': '2375', '技嘉': '2376', '微星': '2377', '虹光': '2380', '台光電': '2383',
    '群光': '2385', '精元': '2387', '威盛': '2388', '云辰': '2390', '正崴': '2392',
    '億光': '2393', '研華': '2395', '友通': '2397', '映泰': '2399', '凌陽': '2401',
    '毅嘉': '2402', '漢唐': '2404', '浩鑫': '2405', '國碩': '2406', '中華電': '2412',
    '環科': '2413', '精技': '2414', '錩新': '2415', '圓剛': '2417', '仲琦': '2419',
    '新巨': '2420', '建準': '2421', '固緯': '2423', '隴華': '2424', '承啟': '2425',
    '鼎元': '2426', '三商電': '2427', '興勤': '2428', '銘旺科': '2429', '燦坤': '2430',
    '聯昌': '2431', '互盛電': '2433', '統懋': '2434', '偉詮電': '2436', '翔耀': '2438',
    '美律': '2439', '太空梭': '2440', '超豐': '2441', '新美齊': '2442', '億麗': '2443',
    '兆勁': '2444', '京元電子': '2449', '神腦': '2450', '創見': '2451', '凌群': '2453',
    '全新': '2455', '奇力新': '2456', '飛宏': '2457', '義隆': '2458', '敦吉': '2459',
    '建通': '2460', '光群雷': '2461', '良得電': '2462', '盟立': '2464', '麗臺': '2465',
    '冠西電': '2466', '志聖': '2467', '華經': '2468', '資通': '2471', '立隆電': '2472',
    '可成': '2474', '鉅祥': '2476', '美隆電': '2477', '大毅': '2478', '敦陽科': '2480',
    '強茂': '2481', '連宇': '2482', '百容': '2483', '希華': '2484', '兆赫': '2485',
    '一詮': '2486', '漢平': '2488', '瑞軒': '2489', '吉祥全': '2491', '華新科': '2492',
    '揚博': '2493', '普安': '2495', '卓越': '2496', '怡利電': '2497', '宏達電': '2498',
    '國建': '2501', '國產': '2504', '國揚': '2505', '太設': '2506', '全坤建': '2509',
    '太子': '2511', '龍邦': '2514', '中工': '2515', '新建': '2516', '冠德': '2520',
    '京城': '2524', '宏璟': '2527', '皇普': '2528', '華建': '2530', '宏盛': '2534',
    '達欣工': '2535', '宏普': '2536', '聯上發': '2537', '基泰': '2538', '櫻花建': '2539',
    '愛山林': '2540', '興富發': '2542', '皇昌': '2543', '皇翔': '2545', '根基': '2546',
    '日勝生': '2547', '華固': '2548', '綠意': '2596', '潤弘': '2597', '樂揚': '2599',
    '益航': '2601', '長榮': '2603', '新興': '2605', '裕民': '2606', '榮運': '2607',
    '嘉里大榮': '2608', '陽明': '2609', '華航': '2610', '志信': '2611', '中航': '2612',
    '中櫃': '2613', '東森': '2614', '萬海': '2615', '山隆': '2616', '台航': '2617',
    '長榮航': '2618', '亞航': '2630', '台灣高鐵': '2633', '漢翔': '2634', '台驊投控': '2636',
    '慧洋-KY': '2637', '大車隊': '2640', '正德': '2641', '宅配通': '2642', '捷迅': '2643',
    '萬企': '2701', '華園': '2702', '國賓': '2704', '六福': '2705', '第一店': '2706',
    '晶華': '2707', '遠雄來': '2712', '晶悅': '2718', '燦星旅': '2719', '楷捷-KY': '2721',
    '夏都': '2722', '美食-KY': '2723', '富驛-KY': '2724', '雅茗-KY': '2726', '王品': '2727',
    '瓦城': '2729', '美麗信': '2730', '雄獅': '2731', '六角': '2732', '維格': '2733',
    '易飛網': '2734', '高野': '2736', '寒舍': '2739', '天蔥': '2740', '老四川': '2741',
    '山富': '2743', '五福': '2745', '雲品': '2748', '桃禧': '2750', '豆府': '2752',
    '亞洲藏壽司': '2754', '揚秦': '2755', '彰銀': '2801', '京城銀': '2809', '台中銀': '2812',
    '旺旺保': '2816', '華票': '2820', '中壽': '2823', '台產': '2832', '臺企銀': '2834',
    '高雄銀': '2836', '聯邦銀': '2838', '台開': '2841', '遠東銀': '2845', '安泰銀': '2849',
    '新產': '2850', '中再保': '2851', '第一保': '2852', '統一證': '2855', '三商壽': '2867',
    '華南金': '2880', '開發金': '2883', '元大金': '2885', '台新金': '2887', '新光金': '2888',
    '國票金': '2889', '永豐金': '2890', '王道銀行': '2897', '欣欣': '2901', '遠百': '2903',
    '匯僑': '2904', '三商': '2905', '高林': '2906', '特力': '2908', '統領': '2910',
    '麗嬰房': '2911', '統一超': '2912', '農林': '2913', '潤泰全': '2915', '滿心': '2916',
    '鼎固-KY': '2923', '東凌-KY': '2924', '誠品生活': '2926', '紅馬-KY': '2928', '淘帝-KY': '2929',
    '客思達-KY': '2936', '集雅社': '2937', '床的世界': '2938', '凱羿-KY': '2939', '京站': '2942',
    '三商家購': '2945', '歐格': '3002', '健和興': '3003', '豐達科': '3004', '神基': '3005',
    '晶豪科': '3006', '華立': '3010', '今皓': '3011', '晟銘電': '3013', '聯陽': '3014',
    '全漢': '3015', '嘉晶': '3016', '奇鋐': '3017', '同開': '3018', '亞光': '3019',
    '鴻名': '3021', '威強電': '3022', '信邦': '3023', '憶聲': '3024', '星通': '3025',
    '禾伸堂': '3026', '盛達': '3027', '增你強': '3028', '零壹': '3029', '德律': '3030',
    '佰鴻': '3031', '偉訓': '3032', '威健': '3033', '聯詠': '3034', '智原': '3035',
    '文曄': '3036', '欣興': '3037', '全台': '3038', '遠見': '3040', '揚智': '3041',
    '晶技': '3042', '科風': '3043', '健鼎': '3044', '台灣大': '3045', '建碁': '3046',
    '訊舟': '3047', '益登': '3048', '和鑫': '3049', '鈺德': '3050', '力特': '3051',
    '夆典': '3052', '立萬利': '3054', '蔚華科': '3055', '總太': '3056', '喬鼎': '3057',
    '立德': '3058', '華晶科': '3059', '銘異': '3060', '建漢': '3062', '泰偉': '3064',
    '李洲': '3066', '全域': '3067', '協禧': '3071', '凱柏實業': '3073', '僑威': '3078',
    '聯亞': '3081', '網龍': '3083', '華義': '3086', '艾訊': '3088', '元炬': '3089',
    '日電貿': '3090', '鴻碩': '3092', '港建': '3093', '聯傑': '3094', '及成': '3095',
    '拍檔': '3097', '穩懋': '3105', '好德': '3114', '寶島極': '3115', '年程': '3117',
    '進階': '3118', '笙泉': '3122', '昇銳': '3128', '一零四': '3130', '弘塑': '3131',
    '耀登': '3138', '晶宏': '3141', '新揚科': '3144', '大綜': '3147', '正達': '3149',
    '鈺寶': '3150', '璟德': '3152', '嘉實': '3158', '精確': '3162', '波若威': '3163',
    '景岳': '3164', '大量': '3167', '眾福科': '3168', '亞信': '3169', '新洲': '3171',
    '基亞': '3176', '公準': '3178', '微邦': '3184', '鑫龍騰': '3188', '景碩': '3189',
    '和進': '3191', '樺晟': '3202', '志豐': '3206', '耀勝': '3207', '全科': '3209',
    '順達': '3211', '茂訊': '3213', '優群': '3217', '大學光': '3218', '台嘉碩': '3221',
    '三顧': '3224', '至寶電': '3226', '原相': '3227', '金麗科': '3228', '晟鈦': '3229',
    '錦明': '3230', '緯創': '3231', '昱捷': '3232', '光環': '3234', '千如': '3236',
    '海灣': '3252', '虹冠電': '3257', '鑫創': '3259', '威剛': '3260', '欣銓': '3264',
    '台星科': '3265', '昇陽': '3266', '海德威': '3268', '東碩': '3272', '宇環': '3276',
    '太普高': '3284', '微端': '3285', '廣寰科': '3287', '點晶': '3288', '宜特': '3289',
    '東浦': '3290', '鈊象': '3293', '英濟': '3294', '勝德': '3296', '杭特': '3297',
    '岱稜': '3303', '昇貿': '3305', '鼎天': '3306', '聯德': '3308', '佳穎': '3310',
    '閎暉': '3311', '弘憶股': '3312', '斐成': '3313', '尼克森': '3317', '同泰': '3321',
    '建舜電': '3322', '加百裕': '3323', '雙鴻': '3324', '旭品': '3325', '幸康': '3332',
    '泰碩': '3338', '泰谷': '3339', '麗清': '3346', '寶德': '3349', '律勝': '3354',
    '奇偶': '3356', '臺慶科': '3357', '尚立': '3360', '先進光': '3362', '上詮': '3363',
    '典範': '3372', '熱映': '3373', '精材': '3374', '新日興': '3376', '健格': '3377',
    '彬台': '3379', '明泰': '3380', '新世紀': '3383', '崇越電': '3388', '旭軟': '3390',
    '佳得': '3391', '漢科': '3402', '玉晶光': '3406', '京鼎': '3413', '融程電': '3416',
    '譁裕': '3419', '台興': '3426', '彥陽': '3429', '奇鈦科': '3430', '台端': '3432',
    '哲固': '3434', '榮創': '3437', '類比科': '3438', '聯一光': '3441', '創意': '3443',
    '利機': '3444', '聯鈞': '3450', '晶睿': '3454', '由田': '3455', '進泰電子': '3465',
    '致振': '3466', '安勤': '3479', '力致': '3483', '崧騰': '3484', '敘豐': '3485',
    '森寶': '3489', '單井': '3490', '昇達科': '3491', '長盛': '3492', '誠研': '3494',
    '陽程': '3498', '環天科': '3499', '維熹': '3501', '揚明光': '3504', '位速': '3508',
    '矽瑪': '3511', '皇龍': '3512', '華擎': '3515', '亞帝歐': '3516', '柏騰': '3518',
    '振維': '3520', '鴻翊': '3521', '御頂': '3522', '迎輝': '3523', '凡甲': '3526',
    '聚積': '3527', '安馳': '3528', '力旺': '3529', '晶相光': '3530', '先益': '3531',
    '台勝科': '3532', '嘉澤': '3533', '晶彩科': '3535', '誠創': '3536', '堡達': '3537',
    '曜越': '3540', '西柏': '3541', '州巧': '3543', '敦泰': '3545', '宇峻': '3546',
    '兆利': '3548', '聯穎': '3550', '世禾': '3551', '同致': '3552', '重鵬': '3555',
    '禾瑞亞': '3556', '嘉威': '3557', '神準': '3558', '牧德': '3563', '其陽': '3564',
    '逸昌': '3567', '大塚': '3570', '聯合再生': '3576', '泓格': '3577', '友威科': '3580',
    '博磊': '3581', '辛耘': '3583', '聯致': '3585', '閎康': '3587', '通嘉': '3588',
    '艾笛森': '3591', '瑞鼎': '3592', '力銘': '3593', '磐儀': '3594', '山太士': '3595',
    '智易': '3596', '映興': '3597', '建祥國際': '3603', '宏致': '3605', '谷崧': '3607',
    '東林': '3609', '鼎翰': '3611', '安可': '3615', '碩天': '3617', '洋華': '3622',
    '富晶通': '3623', '光頡': '3624', '西勝': '3625', '華信科': '3627', '盈正': '3628',
    '地心引力': '3629', '新鉅科': '3630', '晟楠': '3631', '研勤': '3632', '云光': '3633',
    '駿熠電': '3642', '達邁': '3645', '艾恩特': '3646', '精聯': '3652', '健策': '3653',
    '百辰': '3659', '世芯-KY': '3661', '鑫科': '3663', '安瑞-KY': '3664', '貿聯-KY': '3665',
    '光耀': '3666', '圓展': '3669', '康聯訊': '3672', 'TPK-KY': '3673', '康訊': '3674',
    '德微': '3675', '聯享': '3678', '新至陞': '3679', '家登': '3680', '亞太電': '3682',
    '榮昌': '3684', '元創精密': '3685', '達能': '3686', '歐買尬': '3687', '華立捷': '3688',
    '湧德': '3689', '碩禾': '3691', '營邦': '3693', '海華': '3694', '隆達': '3698',
    '大眾控': '3701', '大聯大': '3702', '欣陸': '3703', '合勤控': '3704', '永信': '3705',
    '神達': '3706', '漢磊': '3707', '上緯投控': '3708', '鑫聯大投控': '3709', '連展投控': '3710',
    '日月光投控': '3711', '永崴投控': '3712', '新晶投控': '3713', '富采': '3714', '永日': '4102',
    '佳醫': '4104', '東洋': '4105', '雃博': '4106', '邦特': '4107', '懷特': '4108',
    '加捷生醫': '4109', '濟生': '4111', '聯上': '4113', '健喬': '4114', '明基醫': '4116',
    '普生': '4117', '友華': '4120', '晟德': '4123', '太醫': '4126', '天良': '4127',
    '中天': '4128', '聯合': '4129', '健亞': '4130', '晶宇': '4131', '國鼎': '4132',
    '亞諾法': '4133', '太和-KY': '4136', '麗豐-KY': '4137', '曜亞': '4138', '馬光-KY': '4139',
    '龍燈-KY': '4141', '國光生': '4142', '康聯-KY': '4144', '全宇生技-KY': '4148', '優你康': '4150',
    '明躍': '4151', '鈺緯': '4153', '康樂-KY': '4154', '訊映': '4155', '太景*-KY': '4157',
    '創源': '4160', '聿新科': '4161', '智擎': '4162', '鐿鈦': '4163', '承業醫': '4164',
    '友霖': '4166', '展旺': '4167', '醣聯': '4168', '泰宗': '4169', '鑫品': '4170',
    '瑞基': '4171', '因華': '4172', '久裕': '4173', '杏一': '4175', '福永生技': '4183',
    '尖端醫': '4186', '安克': '4188', '佐登-KY': '4190', '法德藥': '4191', '杏國': '4192',
    '禾生技': '4194', '基米': '4195', '暐世': '4197', '環瑞醫': '4198', '中華食': '4205',
    '環泰': '4207', '信立': '4303', '勝昱': '4304', '世坤': '4305', '炎洲': '4306',
    '東隆興': '4401', '福大': '4402', '新昕纖': '4406', '飛寶企業': '4413', '如興': '4414',
    '三圓': '4416', '金洲': '4417', '元勝': '4419', '光明': '4420', '利勤': '4426',
    '聚紡': '4429', '耀億': '4430', '敏成': '4431', '銘旺實': '4432', '興采': '4433',
    '廣越': '4438', '冠星-KY': '4439', '宜新實業': '4440', '健信': '4502', '金雨': '4503',
    '崇友': '4506', '高鋒': '4510', '福裕': '4513', '永彰': '4523', '東台': '4526',
    '方土霖': '4527', '江興鍛': '4528', '淳紳': '4529', '宏易': '4530', '瑞智': '4532',
    '協易機': '4533', '慶騰': '4534', '至興': '4535', '拓凱': '4536', '旭東': '4537',
    '大詠城': '4538', '全球傳動': '4540', '晟田': '4541', '科嶠': '4542', '萬在': '4543',
    '春日': '4544', '銘鈺': '4545', '長亨': '4546', '桓達': '4549', '長佳': '4550',
    '智伸科': '4551', '力達-KY': '4552', '盛復': '4553', '橙的': '4554', '氣立': '4555',
    '旭然': '4556', '永新-KY': '4557', '寶緯': '4558', '久裕興': '4559', '強信-KY': '4560',
    '健椿': '4561', '穎漢': '4562', '百德': '4563', '元翎': '4564', '宏偉': '4565',
    '時碩工業': '4566', '科際精密': '4568', '傑生': '4570', '鈞興-KY': '4571', '駐龍': '4572',
    '高明鐵': '4573', '銓寶': '4575', '大銀微系統': '4576', '總格精密': '4578', '捷流閥業': '4580',
    '光隆精密-KY': '4581', '聚恆': '4582', '唐鋒': '4609', '中美實': '4702', '大恭': '4706',
    '磐亞': '4707', '永純': '4711', '南璋': '4712', '永捷': '4714', '大立': '4716',
    '德淵': '4720', '美琪瑪': '4721', '國精化': '4722', '信昌化': '4725', '永昕': '4726',
    '雙美': '4728', '熒茂': '4729', '通用': '4730', '彥臣': '4732', '豪展': '4735',
    '泰博': '4736', '華廣': '4737', '尚化': '4738', '康普': '4739', '泓瀚': '4741',
    '合一': '4743', '皇將': '4744', '合富-KY': '4745', '台耀': '4746', '強生': '4747',
    '國碳科': '4754', '三福化': '4755', '勤凱': '4760', '材料-KY': '4763', '雙鍵': '4764',
    '磐采': '4765', '南寶': '4766', '誠泰科技': '4767', '晶呈科技': '4768', 'VHQ-KY': '4803',
    '大略-KY': '4804', '昇華': '4806', '日成-KY': '4807', '聯光通': '4903', '遠傳': '4904',
    '台聯電': '4905', '正文': '4906', '富宇': '4907', '前鼎': '4908', '新復興': '4909',
    '德英': '4911', '聯德控股-KY': '4912', '致伸': '4915', '事欣科': '4916', '新唐': '4919',
    '力士': '4923', '欣厚-KY': '4924', '智微': '4925', '泰鼎-KY': '4927', '燦星網': '4930',
    '新盛力': '4931', '友輝': '4933', '太極': '4934', '茂林-KY': '4935', '和碩': '4938',
    '亞電': '4939', '嘉彰': '4942', '康控-KY': '4943', '兆遠': '4944', '陞達科技': '4945',
    '辣椒': '4946', '牧東': '4950', '精拓科': '4951', '凌通': '4952', '緯軟': '4953',
    '光鋐': '4956', '臻鼎-KY': '4958', '誠美材': '4960', '天鈺': '4961', '譜瑞-KY': '4966',
    '十銓': '4967', '立積': '4968', 'IET-KY': '4971', '湯石照明': '4972', '廣穎': '4973',
    '亞泰': '4974', '佳凌': '4976', '眾達-KY': '4977', '華星光': '4979', '佐臻': '4980',
    '科誠': '4987', '榮科': '4989', '環宇-KY': '4991', '傳奇': '4994', '晶達': '4995',
    '鑫禾': '4999', '三星': '5007', '榮剛': '5009', '久陽': '5011', '強新': '5013',
    '建錩': '5014', '華祺': '5015', '松和': '5016', '富強': '5102', '凱衛': '5201',
    '力新': '5202', '訊連': '5203', '中茂': '5205', '坤悅': '5206', '新鼎': '5209',
    '寶碩': '5210', '蒙恬': '5211', '凌網': '5212', '亞昕': '5213', '科嘉-KY': '5215',
    '優燈': '5216', '萬達光電': '5220', '全訊': '5222', '安力-KY': '5223', '東科-KY': '5225',
    '立凱-KY': '5227', '鈺鎧': '5228', '雷笛克光學': '5230', '有量': '5233', '達興材料': '5234',
    '建騰': '5240', '乙盛-KY': '5243', '弘凱': '5244', '智晶': '5245', '景傳': '5248',
    '天鉞電': '5251', '欣訊科技': '5254', '虹堡': '5258', '立達': '5262', '智崴': '5263',
    '鎧勝-KY': '5264', '龍翩': '5267', '祥碩': '5269', '紘通': '5271', '笙科': '5272',
    '信驊': '5274', '達輝-KY': '5276', '葳天': '5277', '尚凡': '5278', '大峽谷-KY': '5281',
    '禾聯碩': '5283', 'jpp-KY': '5284', '界霖': '5285', '數字': '5287', '豐祥-KY': '5288',
    '宜鼎': '5289', '邑昇': '5291', '華懋': '5292', '廣化': '5297', '杰力': '5299',
    '寶得利': '5301', '太欣': '5302', '鼎創達': '5304', '敦南': '5305', '桂盟': '5306',
    '系統電': '5309', '天剛': '5310', '寶島科': '5312', '世紀': '5314', '光聯': '5315',
    '友銓': '5321', '士開': '5324', '華容': '5328', '建榮': '5340', '立衛': '5344',
    '天揚': '5345', '世界': '5347', '系通': '5348', '先豐': '5349', '鈺創': '5351',
    '台林': '5353', '佳總': '5355', '協益': '5356', '力麗店': '5364', '中光電': '5371',
    '合正': '5381', '金利': '5383', '青雲': '5386', '中磊': '5388', '應華': '5392',
    '慕康生醫': '5398', '中菲': '5403', '國眾': '5410', '台半': '5425', '振發': '5426',
    '達威': '5432', '崇越': '5434', '東友': '5438', '高技': '5439', '均豪': '5443',
    '寶聯通': '5450', '佶優': '5452', '昇益': '5455', '宣德': '5457', '同協': '5460',
    '霖宏': '5464', '富驊': '5465', '凱鈺': '5468', '瀚宇博': '5469', '松翰': '5471',
    '聰泰': '5474', '德宏': '5475', '智冠': '5478', '新華': '5481', '中美晶': '5483',
    '慧友': '5484', '通泰': '5487', '松普': '5488', '彩富': '5489', '同亨': '5490',
    '三聯': '5493', '凱崴': '5498', '永信建': '5508', '德昌': '5511', '力麒': '5512',
    '三豐': '5514', '建國': '5515', '雙喜': '5516', '隆大': '5519', '力泰': '5520',
    '工信': '5521', '遠雄': '5522', '豐謙': '5523', '順天': '5525', '志嘉': '5529',
    '龍巖': '5530', '鄉林': '5531', '皇鼎': '5533', '長虹': '5534', '聖暉': '5536',
    '東明-KY': '5538', '崇佑-KY': '5543', '永固-KY': '5546', '久舜': '5547', '台聯櫃': '5601',
    '陸海': '5603', '中連貨': '5604', '遠雄港': '5607', '四維航': '5608', '中菲行': '5609',
    '劍湖山': '5701', '亞都': '5703', '老爺知': '5704', '鳳凰': '5706', '日盛金': '5820',
    '遠壽': '5859', '瑞興銀': '5863', '致和證': '5864', '中租-KY': '5871', '上海商銀': '5876',
    '台名': '5878', '合庫金': '5880', '德記': '5902', '全家': '5903', '寶雅': '5904',
    '南仁湖': '5905', '台南-KY': '5906', '大洋-KY': '5907', '群益證': '6005', '宏遠證': '6015',
    '康和證': '6016', '大展證': '6020', '大慶證': '6021', '元大期': '6023', '群益期': '6024',
    '福邦證': '6026', '德信': '6027', '公勝保經': '6028', '寬魚國際': '6101', '合邦': '6103',
    '創惟': '6104', '競國': '6108', '亞元': '6109', '大宇資': '6111', '聚碩': '6112',
    '亞矽': '6113', '久威': '6114', '鎰勝': '6115', '彩晶': '6116', '迎廣': '6117',
    '建達': '6118', '達運': '6120', '新普': '6121', '擎邦': '6122', '上奇': '6123',
    '業強': '6124', '廣運': '6125', '信音': '6126', '九豪': '6127', '上福': '6128',
    '普誠': '6129', '星寶國際': '6130', '鈞泰': '6131', '金橋': '6133', '萬旭': '6134',
    '富爾特': '6136', '茂達': '6138', '亞翔': '6139', '訊達': '6140', '柏承': '6141',
    '友勁': '6142', '振曜': '6143', '得利影': '6144', '耕興': '6146', '頎邦': '6147',
    '驊宏資': '6148', '撼訊': '6150', '晉倫': '6151', '百一': '6152', '嘉聯益': '6153',
    '順發': '6154', '鈞寶': '6155', '松上': '6156', '禾昌': '6158', '欣技': '6160',
    '捷波': '6161', '華電網': '6163', '華興': '6164', '捷泰': '6165', '凌華': '6166',
    '久正': '6167', '宏齊': '6168', '昱泉': '6169', '統振': '6170', '亞銳士': '6171',
    '互億': '6172', '信昌電': '6173', '安碁': '6174', '立敦': '6175', '瑞儀': '6176',
    '達麗': '6177', '亞通': '6179', '橘子': '6180', '合晶': '6182', '關貿': '6183',
    '大豐電': '6184', '幃翔': '6185', '新潤': '6186', '萬潤': '6187', '廣明': '6188',
    '豐藝': '6189', '萬泰科': '6190', '精成科': '6191', '巨路': '6192', '育富': '6194',
    '詩肯': '6195', '帆宣': '6196', '佳必琪': '6197', '凌泰': '6198', '天品': '6199',
    '亞弘電': '6201', '盛群': '6202', '海韻電': '6203', '艾華': '6204', '詮欣': '6205',
    '飛捷': '6206', '雷科': '6207', '日揚': '6208', '今國光': '6209', '慶生': '6210',
    '理銘': '6212', '聯茂': '6213', '精誠': '6214', '和椿': '6215', '居易': '6216',
    '中探針': '6217', '豪勉': '6218', '富旺': '6219', '岳豐': '6220', '晉泰': '6221',
    '上揚': '6222', '旺矽': '6223', '聚鼎': '6224', '天瀚': '6225', '光鼎': '6226',
    '茂綸': '6227', '全譜': '6228', '研通': '6229', '超眾': '6230', '系微': '6231',
    '旺玖': '6233', '高僑': '6234', '華孚': '6235', '康呈': '6236', '驊訊': '6237',
    '力成': '6239', '松崗': '6240', '易通展': '6241', '立康': '6242', '迅杰': '6243',
    '茂迪': '6244', '立端': '6245', '臺龍': '6246', '淇譽電': '6247', '沛波': '6248',
    '定穎': '6251', '矽格': '6257', '百徽': '6259', '久元': '6261', '普萊德': '6263',
    '富裔': '6264', '方土昶': '6265', '泰詠': '6266', '台郡': '6269', '倍微': '6270',
    '同欣電': '6271', '驊陞': '6272', '台燿': '6274', '元山': '6275', '安鈦克': '6276',
    '宏正': '6277', '台表科': '6278', '胡連': '6279', '全國電': '6281', '康舒': '6282',
    '淳安': '6283', '佳邦': '6284', '啟碁': '6285', '元隆': '6287', '聯嘉': '6288',
    '華上': '6289', '良維': '6290', '沛亨': '6291', '迅德': '6292', '智基': '6294',
    '群登': '6403', '通訊-KY': '6404', '悅城': '6405', '相互': '6407', '旭隼': '6409',
    '晶焱': '6411', '群電': '6412', '樺漢': '6414', '矽力-KY': '6415', '瑞祺電通': '6416',
    '韋僑': '6417', '詠昇': '6418', '京晨科': '6419', '億而得': '6423', '易發': '6425',
    '統新': '6426', '淘米': '6428', '光麗-KY': '6431', '今展科': '6432', '達輝光電': '6434',
    '大中': '6435', '迅得': '6438', '廣錠': '6441', '光聖': '6442', '元晶': '6443',
    '經絡醫': '6445', '藥華藥': '6446', '鈺邦': '6449', '訊芯-KY': '6451', '康友-KY': '6452',
    'GIS-KY': '6456', '紘康': '6457', '益得': '6461', '神盾': '6462', '台數科': '6464',
    '威潤': '6465', '棒辣椒': '6468', '大樹': '6469', '宇智': '6470', '保瑞': '6472',
    '好玩家*': '6473', '華豫寧': '6474', '岱煒': '6475', '安集': '6477', '弘煜科': '6482',
    '點序': '6485', '互動': '6486', '環球晶': '6488', '晶碩': '6491', '生華科': '6492',
    '雷虎生': '6493', '九齊': '6494', '納諾*-KY': '6495', '科懋': '6496', '亞獅康-KY': '6497',
    '久禾光': '6498', '益安': '6499', '南六': '6504', '台塑化': '6505', '雙邦': '6506',
    '惠光': '6508', '聚和': '6509', '精測': '6510', '啟發電': '6512', '芮特-KY': '6514',
    '穎崴': '6515', '勤崴國際': '6516', '康科特': '6518', '達爾膚': '6523', '捷敏-KY': '6525',
    '明達醫': '6527', '研鼎': '6529', '創威': '6530', '愛普': '6531', '瑞耘': '6532',
    '晶心科': '6533', '正瀚': '6534', '順藥': '6535', '碩豐': '6536', '倉和': '6538',
    '翔宇': '6539', '泰福-KY': '6541', '隆中': '6542', '普惠醫工': '6543', '擎力': '6545',
    '高端疫苗': '6547', '長科*': '6548', '景凱': '6549', '北極星藥業-KY': '6550', '易華電': '6552',
    '榮炭': '6555', '勝品': '6556', '興能高': '6558', '研晶': '6559', '欣普羅': '6560',
    '是方': '6561', '安特羅': '6564', '物聯': '6565', '創益': '6566', '宏觀': '6568',
    '醫揚': '6569', '維田': '6570', '博錸': '6572', '虹揚-KY': '6573', '霈方': '6574',
    '心悅': '6575', '逸達': '6576', '勁豐': '6577', '達邦蛋白': '6578', '研揚': '6579',
    '台睿': '6580', '鋼聯': '6581', '申豐': '6582', '友松': '6583', '南俊國際': '6584',
    '鼎基': '6585', '醣基': '6586', '東典光電': '6588', '台康生技': '6589', '普鴻': '6590',
    '動力-KY': '6591', '和潤企業': '6592', '台灣銘板': '6593', '展匯科': '6594', '光禹國際': '6595',
    '寬宏藝術': '6596', '立誠': '6597', 'ABC-KY': '6598', '普達系統': '6599', '富強鑫': '6603',
    '帝寶': '6605', '建德工業': '6606', '瀧澤科': '6609', '安成生技': '6610', '方舟': '6611',
    '奈米醫材': '6612', '朋億': '6613', '慧智': '6615', '特昇-KY': '6616', '共信-KY': '6617',
    '永虹先進': '6618', '漢達': '6620', '華宇藥': '6621', '百聿數碼': '6622', '萬年清': '6624',
    '必應': '6625', '唯數': '6626', '泰金-KY': '6629', '萊鎂醫': '6633', '欣耀': '6634',
    '醫影': '6637', '沅聖': '6638', '源大環能': '6639', '均華': '6640', '基士德-KY': '6641',
    '富致': '6642', 'M31': '6643', '金萬林': '6645', '斯其大': '6648', '台生材': '6649',
    '帝圖': '6650', '全宇昕': '6651', '雅祥生醫': '6652', '天正國際': '6654', '科定': '6655',
    '華安': '6657', '威健生技': '6661', '樂斯科': '6662', '群翊': '6664', '康聯生醫': '6665',
    '羅麗芬-KY': '6666', '信紘科': '6667', '中揚光': '6668', '緯穎': '6669', '復盛應用': '6670',
    '三能-KY': '6671', '騰輝電子-KY': '6672', '和詮': '6673', '鋐寶科技': '6674', '瑩碩生技': '6677',
    '鈺太': '6679', '鑫創電子': '6680', '碩鑽材料': '6682', '雍智科技': '6683', '安格': '6684',
    '海樂影業': '6688', '伊雲谷': '6689', '安碁資訊': '6690', '洋基工程': '6691', '進能服': '6692',
    '廣閎科': '6693', '芯鼎': '6695', '仁新': '6696', '東捷資訊': '6697', '旭暉應材': '6698',
    '奇邑': '6699', '軒郁': '6703', '振躍精密': '6705', '惠特': '6706', '天擎': '6708',
    '昱厚生技': '6709', '長聖': '6712', '博謙生技': '6713', '嘉基': '6715', '應廣': '6716',
    '智慧光': '6717', '久昌': '6720', '信實保全': '6721', '傑智環境': '6723', '創王': '6724',
    '亞泰金屬': '6727', '上洋': '6728', '機光科技': '6729', '常廣': '6730', '啟坤': '6731',
    '昇佳電子': '6732', '博晟生醫': '6733', '安盛生': '6734', '美達科技': '6735', '碩辣椒': '6736',
    '秀育': '6737', '鼎恒': '6738', '松果購物': '6740', '安普新': '6743', '豐技生技': '6744',
    '亨泰光': '6747', '泰創工程': '6750', '智聯服務': '6751', '叡揚資訊': '6752', '匯僑設計': '6754',
    '連鋐科技': '6755', '威鋒電子': '6756', '台灣虎航': '6757', '冠亞': '6758', '穩得': '6761',
    '達亞': '6762', '綠界科技': '6763', '亞洲教育': '6764', '台微醫': '6767', '平和環保': '6771',
    '穎台科技': '6775', '展碁國際': '6776', '崑鼎': '6803', '邑錡': '7402', '達勝': '7419',
    '凡事康': '7443', '環拓科技': '7507', '清淨海': '7516', '知識科技': '7551', '意德士': '7556',
    '台通': '8011', '矽創': '8016', '尖點': '8021', '佑華': '8024', '鈦昇': '8027',
    '昇陽半導體': '8028', '光菱': '8032', '雷虎': '8033', '榮群': '8034', '長園科': '8038',
    '台虹': '8039', '九暘': '8040', '金山電': '8042', '蜜望實': '8043', '網家': '8044',
    '達運光電': '8045', '南電': '8046', '星雲': '8047', '德勝': '8048', '晶采': '8049',
    '廣積': '8050', '安國': '8054', '凱碩': '8059', '東捷': '8064', '來思達': '8066',
    '志旭': '8067', '全達': '8068', '元太': '8069', '長華': '8070', '能率網通': '8071',
    '陞泰': '8072', '鉅橡': '8074', '伍豐': '8076', '洛碁': '8077', '永利聯合': '8080',
    '致新': '8081', '瑞穎': '8083', '巨虹': '8084', '福華': '8085', '宏捷科': '8086',
    '華鎂鑫': '8087', '品安': '8088', '康全電訊': '8089', '翔名': '8091', '建暐': '8092',
    '保銳': '8093', '擎亞': '8096', '常珵': '8097', '大世科': '8099', '華冠': '8101',
    '瀚荃': '8103', '錸寶': '8104', '凌巨': '8105', '大億金茂': '8107', '博大': '8109',
    '華東': '8110', '立碁': '8111', '至上': '8112', '振樺電': '8114', '帝聞': '8115',
    '公信': '8119', '越峰': '8121', '福懋科': '8131', '正淩': '8147', '南茂': '8150',
    '博智': '8155', '達方': '8163', '天宇': '8171', '智捷': '8176', '旭德': '8179',
    '加高': '8182', '精星': '8183', '無敵': '8201', '勤誠': '8210', '志超': '8213',
    '明基材': '8215', '寶一': '8222', '新漢': '8234', '華宏': '8240', '菱光': '8249',
    '朋程': '8255', '富鼎': '8261', '宇瞻': '8271', '商丞': '8277', '生展': '8279',
    '歐普羅': '8281', '三竹': '8284', '泰藝': '8289', '尚茂': '8291', '威睿': '8298',
    '群聯': '8299', '台視': '8329', '日友': '8341', '益張': '8342', '恒耀': '8349',
    '冠好': '8354', '金居': '8358', '錢櫃': '8359', '建新國際': '8367', '羅昇': '8374',
    '千附': '8383', '金益鼎': '8390', '白紗科': '8401', '盛弘': '8403', '百和興業-KY': '8404',
    '金可-KY': '8406', '商之器': '8409', '森田': '8410', '福貞-KY': '8411', '大國鋼': '8415',
    '實威': '8416', '捷必勝-KY': '8418', '明揚': '8420', '旭源': '8421', '可寧衛': '8422',
    '保綠-KY': '8423', '惠普': '8424', '紅木-KY': '8426', '基勝-KY': '8427', '金麗-KY': '8429',
    '匯鑽科': '8431', '東生華': '8432', '弘帆': '8433', '鉅邁': '8435', '大江': '8436',
    '大地-KY': '8437', '昶昕': '8438', '綠電': '8440', '威宏-KY': '8442', '阿瘦': '8443',
    '綠河-KY': '8444', '華研': '8446', '霹靂': '8450', '富邦媒': '8454', '大拓-KY': '8455',
    '影一': '8458', '柏文': '8462', '潤泰材': '8463', '億豐': '8464', '德河': '8465',
    '美吉吉-KY': '8466', '波力-KY': '8467', '夠麻吉': '8472', '山林水': '8473', '台境': '8476',
    '創業家': '8477', '東哥遊艇': '8478', '泰昇-KY': '8480', '政伸': '8481', '商億-KY': '8482',
    '愛爾達': '8487', '吉源-KY': '8488', '三貝德': '8489', '利得': '8490', '真好玩': '8491',
    '兔將': '8492', '經緯航': '8495', '格威傳媒': '8497', '鼎炫-KY': '8499', '裕國': '8905',
    '花王': '8906', '欣雄': '8908', '光隆': '8916', '欣泰': '8917', '沈氏': '8921',
    '時報': '8923', '大田': '8924', '台汽電': '8926', '北基': '8927', '鉅明': '8928',
    '富堡': '8929', '青鋼': '8930', '大汽電': '8931', '宏大': '8932', '愛地雅': '8933',
    '衡平': '8934', '邦泰': '8935', '國統': '8936', '合騏': '8937', '明安': '8938',
    '新天地': '8940', '關中': '8941', '森鉅': '8942', '高力': '8996', '鈺齊-KY': '9802',
    '台火': '9902', '寶成': '9904', '大華': '9905', '欣巴巴': '9906', '統一實': '9907',
    '大台北': '9908', '豐泰': '9910', '櫻花': '9911', '偉聯': '9912', '美利達': '9914',
    '中保科': '9917', '欣天然': '9918', '康那香': '9919', '巨大': '9921', '福興': '9924',
    '新保': '9925', '新海': '9926', '泰銘': '9927', '中視': '9928', '秋雨': '9929',
    '中聯資源': '9930', '欣高': '9931', '中鼎': '9933', '成霖': '9934', '慶豐富': '9935',
    '全國': '9937', '百和': '9938', '宏全': '9939', '信義': '9940', '裕融': '9941',
    '茂順': '9942', '好樂迪': '9943', '新麗': '9944', '潤泰新': '9945', '三發地產': '9946',
    '琉園': '9949', '萬國通': '9950', '皇田': '9951', '佳龍': '9955', '燁聯': '9957',
    '世紀鋼': '9958', '邁達康': '9960', '有益': '9962',
}

# 建立反向查詢字典 (代號 -> 公司名稱列表)
CODE_TO_NAMES = defaultdict(list)
for name, code in COMPANY_DATABASE.items():
    CODE_TO_NAMES[code].append(name)

# 編譯公司名稱正則表達式
COMPANY_PATTERN = re.compile('|'.join(map(re.escape, COMPANY_DATABASE.keys())))

# 股票代號格式 (4碼數字)
STOCK_CODE_PATTERN = re.compile(r'\b(\d{4})\b')

# ==================== 股票相關動作關鍵字 ====================
STOCK_ACTION_KEYWORDS = [
    '股價', '收盤', '開盤', '漲停', '跌停', '漲幅', '跌幅',
    '成交量', '營收', '獲利', '虧損', '財報', 'EPS',
    '配息', '除權', '除息', '股利', '增資', '減資',
    '法說會', '董事會', '股東會', '併購', '收購',
    '市值', '本益比', '殖利率', '毛利率'
]

STOCK_ACTION_PATTERN = re.compile('|'.join(map(re.escape, STOCK_ACTION_KEYWORDS)), re.IGNORECASE)

# ==================== 核心處理函數 ====================

def extract_date_fast(text):
    """快速日期提取"""
    if not text:
        return None
    
    patterns = [
        (r'(\d{4})/(\d{1,2})/(\d{1,2})', lambda m: f"{m.group(1)}/{int(m.group(2)):02d}/{int(m.group(3)):02d}"),
        (r'(\d{4})-(\d{2})-(\d{2})', lambda m: m.group(0)),
        (r'(\d{4})\s*年\s*(\d{1,2})\s*月\s*(\d{1,2})\s*日', 
         lambda m: f"{m.group(1)}/{int(m.group(2)):02d}/{int(m.group(3)):02d}"),
    ]
    
    for pattern, formatter in patterns:
        match = re.search(pattern, text[:500])
        if match:
            return formatter(match)
    
    return None

def clean_text_fast(text):
    """快速文字清理"""
    if not text:
        return ""
    text = re.sub(r'\s+', ' ', text)
    text = re.sub(r'(分享到|分享至|返回列表|列印|上一篇|下一篇).*?(?=\s|$)', '', text)
    return text.strip()

def extract_companies_and_codes(text):
    """
    從文字中提取公司名稱和股票代號
    返回: {
        'companies': [(公司名, 代號), ...],
        'codes': [代號1, 代號2, ...],
        'company_names': [名稱1, 名稱2, ...]
    }
    """
    companies = []
    codes_set = set()
    names_set = set()
    
    # 1. 提取已知公司名稱
    company_matches = COMPANY_PATTERN.findall(text)
    for company_name in company_matches:
        code = COMPANY_DATABASE[company_name]
        companies.append((company_name, code))
        codes_set.add(code)
        # 找出這個代號對應的所有名稱（主要名稱）
        primary_name = CODE_TO_NAMES[code][0]
        names_set.add(primary_name)
    
    # 2. 提取4碼股票代號
    code_matches = STOCK_CODE_PATTERN.findall(text)
    for code in code_matches:
        # 檢查是否為已知股票代號
        if code in CODE_TO_NAMES:
            primary_name = CODE_TO_NAMES[code][0]
            companies.append((primary_name, code))
            codes_set.add(code)
            names_set.add(primary_name)
    
    return {
        'companies': list(set(companies)),  # 去重
        'codes': sorted(codes_set),
        'company_names': sorted(names_set)
    }

def check_stock_relevance(text, company_info):
    """
    檢查文本是否真的在討論個股表現
    必須同時提到公司且有股票相關動作關鍵字
    """
    if not company_info['companies']:
        return False
    
    # 檢查是否有股票相關動作
    stock_actions = STOCK_ACTION_PATTERN.findall(text)
    
    return len(stock_actions) > 0

def is_market_overview_only(text):
    """
    檢查是否只是大盤概況（排除這類文章）
    """
    # 如果有排除關鍵字但沒有具體公司，可能只是大盤新聞
    exclude_count = len(EXCLUDE_PATTERN.findall(text))
    
    # 如果排除關鍵字出現超過3次，可能主要是大盤新聞
    return exclude_count >= 3

def parse_html_minimal(html_content, file_path):
    """最小化HTML解析"""
    try:
        soup = BeautifulSoup(html_content, 'lxml')
        
        # 移除雜訊標籤
        for tag in soup(['script', 'style', 'nav', 'footer', 'iframe']):
            tag.decompose()
        
        # 標題
        title = None
        if soup.find('h1', class_='title_'):
            title = soup.find('h1', class_='title_').get_text(strip=True)
        elif soup.find('meta', property='og:title'):
            title = soup.find('meta', property='og:title').get('content', '')
        elif soup.find('title'):
            title = soup.find('title').get_text(strip=True)
        
        # 內容
        content = None
        content_div = soup.find('div', class_='edit')
        if content_div:
            section = content_div.find('section')
            if section:
                content = section.get_text(separator=' ', strip=True)
        
        if not content:
            paragraphs = [p.get_text(separator=' ', strip=True) 
                         for p in soup.find_all(['p', 'article']) 
                         if len(p.get_text(strip=True)) > 100]
            if paragraphs:
                content = max(paragraphs, key=len)
        
        # 日期
        date = None
        date_elem = soup.find('span', class_='date')
        if date_elem:
            date = extract_date_fast(date_elem.get_text())
        
        if not date:
            page_header = soup.get_text()[:800]
            date = extract_date_fast(page_header)
        
        # 分類
        category = None
        breadcrumb = soup.find('ol', class_='bread_crumbs')
        if breadcrumb:
            cats = [li.get_text(strip=True) for li in breadcrumb.find_all('li')]
            if len(cats) > 1:
                category = cats[-2] if len(cats) > 2 else cats[-1]
        
        return {
            'title': clean_text_fast(title),
            'content': clean_text_fast(content),
            'date': date,
            'category': category
        }
    except:
        return None

def process_single_file(file_path):
    """處理單個檔案（個股分析版）"""
    try:
        # 讀取檔案
        with open(file_path, 'rb') as f:
            content_bytes = f.read()
        
        html_content = content_bytes.decode('utf-8', errors='ignore')
        parsed = parse_html_minimal(html_content, file_path)
        
        if not parsed or not parsed['title'] or not parsed['content']:
            return None
        
        # 長度檢查
        if len(parsed['content']) < MIN_CONTENT_LENGTH:
            return None
        
        # 合併標題與內容進行分析
        combined_text = f"{parsed['title']} {parsed['content']}"
        
        # 【關鍵】檢查是否只是大盤新聞
        if is_market_overview_only(combined_text):
            return None
        
        # 提取公司資訊
        company_info = extract_companies_and_codes(combined_text)
        
        # 【關鍵】必須提到具體公司
        if not company_info['companies']:
            return None
        
        # 【關鍵】必須真的在討論個股表現
        if not check_stock_relevance(combined_text, company_info):
            return None
        
        return {
            'date': parsed['date'] or '',
            'title': parsed['title'],
            'content': parsed['content'],
            'category': parsed['category'] or '',
            'stock_codes': ','.join(company_info['codes']),
            'company_names': ','.join(company_info['company_names']),
            'company_count': len(company_info['companies'])
        }
    except Exception as e:
        return None

# ==================== 主處理程序 ====================

def process_news_files():
    """主處理函數（單次完整處理）"""
    start_time = time.time()
    root = Path(NEWS_ROOT_FOLDER)
    output_dir = Path.cwd()
    
    if not root.exists():
        print(f"❌ 找不到資料夾: {root}")
        return
    
    # 掃描檔案
    print("🔍 掃描檔案中...")
    all_files = [f for f in root.rglob("*") if f.is_file()]
    
    if TEST_LIMIT:
        all_files = all_files[:TEST_LIMIT]
        print(f"✓ 測試模式: {len(all_files):,} 個檔案")
    else:
        print(f"✓ 完整處理: {len(all_files):,} 個檔案")
    
    if not all_files:
        print("❌ 沒有找到任何檔案")
        return
    
    print(f"\n🚀 使用 {NUM_WORKERS} 個處理器")
    print("📊 篩選條件:")
    print("  ✓ 必須提到具體公司名稱或股票代號")
    print("  ✓ 必須包含個股表現相關內容")
    print("  ✓ 排除純大盤走勢新聞\n")
    
    results = []
    company_stats = Counter()
    date_stats = Counter()
    
    with Pool(NUM_WORKERS) as pool:
        pbar_results = pool.imap_unordered(process_single_file, all_files, chunksize=300)
        
        with tqdm(total=len(all_files), desc="處理進度", unit="檔") as pbar:
            for result in pbar_results:
                if result:
                    results.append(result)
                    
                    # 統計公司出現次數
                    if result['company_names']:
                        for company in result['company_names'].split(','):
                            company_stats[company] += 1
                    
                    # 統計日期分布
                    if result['date']:
                        date_stats[result['date'][:7]] += 1  # 年-月
                
                pbar.update(1)
                pbar.set_postfix({'通過': len(results)})
    
    # 儲存結果
    if results:
        df = pd.DataFrame(results)
        df = df.sort_values(['date', 'company_names']).reset_index(drop=True)
        
        output_path = output_dir / OUT_CSV
        df.to_csv(output_path, index=False, encoding='utf-8-sig')
        print(f"\n✅ 資料已儲存: {output_path}")
        print(f"📊 共 {len(df)} 筆個股相關新聞")
    else:
        print("\n⚠️ 沒有符合條件的新聞")
        return
    
    # 統計報告
    elapsed = time.time() - start_time
    pass_rate = (len(results) / len(all_files) * 100) if len(all_files) > 0 else 0
    
    # 公司統計
    company_report = {
        'total_companies': len(company_stats),
        'top_30_companies': dict(company_stats.most_common(30)),
        'date_distribution': dict(sorted(date_stats.items()))
    }
    
    company_stats_path = output_dir / OUT_COMPANY_STATS
    with open(company_stats_path, 'w', encoding='utf-8') as f:
        json.dump(company_report, f, ensure_ascii=False, indent=2)
    
    # QC報告
    qc_report = {
        'processing_info': {
            'total_files': len(all_files),
            'passed': len(results),
            'pass_rate': f"{pass_rate:.2f}%",
        },
        'filter_settings': {
            'require_company_mention': True,
            'require_stock_actions': True,
            'exclude_market_overview': True,
            'min_content_length': MIN_CONTENT_LENGTH
        },
        'statistics': {
            'unique_companies': len(company_stats),
            'total_company_mentions': sum(company_stats.values()),
            'date_coverage': len(date_stats)
        },
        'performance': {
            'elapsed_time': f"{elapsed:.1f} 秒",
            'processing_speed': f"{len(all_files)/elapsed:.1f} 檔案/秒"
        }
    }
    
    qc_path = output_dir / OUT_QC_REPORT
    with open(qc_path, 'w', encoding='utf-8') as f:
        json.dump(qc_report, f, ensure_ascii=False, indent=2)
    
    # 顯示摘要
    print("\n" + "="*70)
    print("📊 處理結果摘要")
    print("="*70)
    print(f"總檔案數: {len(all_files):,}")
    print(f"通過篩選: {len(results):,} ({pass_rate:.1f}%)")
    print(f"涵蓋公司: {len(company_stats)} 家")
    print(f"總提及次數: {sum(company_stats.values()):,}")
    
    print(f"\n⏱️  處理時間: {elapsed:.1f} 秒")
    print(f"⚡ 處理速度: {len(all_files)/elapsed:.1f} 檔案/秒")
    
    print(f"\n🏢 前20大熱門公司:")
    for i, (company, count) in enumerate(company_stats.most_common(20), 1):
        code = COMPANY_DATABASE.get(company, '未知')
        print(f"  {i:2d}. {company} ({code}): {count} 則")
    
    print(f"\n✅ 公司統計已儲存: {company_stats_path}")
    print(f"✅ 品質報告已儲存: {qc_path}")

if __name__ == "__main__":
    print("="*70)
    print("🚀 個股新聞分析系統 v2.0")
    print("="*70)
    print(f"🖥️  CPU 核心數: {cpu_count()} (使用 {NUM_WORKERS} 個處理器)")
    print(f"📈 已載入 {len(COMPANY_DATABASE)} 家公司資料")
    print(f"🎯 篩選目標: 個別公司股票表現新聞")
    print("="*70 + "\n")
    process_news_files()